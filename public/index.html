<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema</title>
  <link rel="stylesheet" href="framework/css/main.css" />
</head>
<body>
<div id="app"></div>
<script>
  // ==========================================
  // DETECCIÓN AUTOMÁTICA DE RUTAS
  // ==========================================
  
  let version = '0.4.1';
  
  var pathname = window.location.pathname;
  if (pathname.endsWith('/index.html')) {
    pathname = pathname.replace('/index.html', '/');
  }
  pathname = pathname.replace('/public/', '/');
  if (!pathname.endsWith('/')) {
    pathname += '/';
  }

  var BASE_URL = pathname;
  var FRAMEWORK_URL = BASE_URL + 'framework/';
  var PUBLIC_URL = window.location.origin + pathname;

  var OG_IS_DEV = /^(localhost|127\.0\.0\.1|0\.0\.0\.0|.*\.local|192\.168\.|10\.)/.test(window.location.hostname) || 
              ['3000', '5173', '8080'].includes(window.location.port);

  var VERSION = OG_IS_DEV ? `dev-${Date.now()}` : version;
  console.log(`App Version: ${VERSION}`);

  // ==========================================
  // CONFIGURACIÓN ÚNICA DEL PROYECTO
  // ==========================================
  // Esta es la ÚNICA variable que debe existir
  // Similar a como WordPress registra variables de plugins
  
  var appConfig_factory_saas = {
    // Identificación del proyecto
    slug: 'factory-saas',
    
    // Versión y entorno
    version: VERSION,
    environment: OG_IS_DEV ? 'development' : 'production',
    isDevelopment: OG_IS_DEV,
    
    // Paths y URLs
    baseUrl: BASE_URL,
    frameworkUrl: FRAMEWORK_URL,
    publicUrl: PUBLIC_URL,
    frameworkPath: 'framework',
    
    // UI
    container: '#app',

    // Internacionalización
    i18n: {
      enabled: true,
      defaultLang: 'es',
      availableLangs: ['es', 'en'],
      refreshOnChange: false
    },

    // Autenticación
    auth: {
      enabled: true,
      loginView: 'auth/login',
      redirectAfterLogin: 'dashboard/dashboard',
      sessionCheckInterval: 1 * 60 * 1000,
      api: {
        login: '/api/auth/login',
        logout: '/api/auth/logout',
        me: '/api/user/profile'
      }
    },

    // Rutas
    routes: {
      coreViews: 'framework/js/views',
      extensionViews: 'extensions/{extensionName}/views',
      coreModels: 'framework/js/models',
      components: 'framework/js/components',
      utils: 'framework/js/utils',
      validation: 'framework/js/validation'
    },

    // Caché
    cache: {
      modals: !OG_IS_DEV,
      forms: !OG_IS_DEV,
      views: !OG_IS_DEV,
      viewNavigation: !OG_IS_DEV,
      validation: !OG_IS_DEV,
      ttl: 60 * 60 * 1000
    }
  };

  // ==========================================
  // CARGA DEL FRAMEWORK
  // ==========================================
  
  (function() {
    const script = document.createElement('script');
    script.type = 'module';
    script.src = appConfig_factory_saas.frameworkUrl + 'js/main.js?v=' + appConfig_factory_saas.version;
    script.onload = function() {
      if (window.ogFramework) {
        window.ogFramework.init('appConfig_factory_saas');
      } else {
        console.error('❌ ogFramework no se cargó correctamente');
      }
    };
    script.onerror = function() {
      console.error('❌ Error cargando ogFramework');
      document.getElementById('app').innerHTML = `
        <div style="padding: 20px; color: #dc3545; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; margin: 20px;">
          <h2>Error de Carga</h2>
          <p>No se pudo cargar el framework. Por favor, recarga la página.</p>
          <button onclick="location.reload()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">
            Recargar
          </button>
        </div>
      `;
    };
    document.head.appendChild(script);
  })();
</script>
</body>
</html>