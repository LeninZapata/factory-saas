<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema</title>
  <link rel="stylesheet" href="framework/css/main.css" />
</head>
<body>
<div id="app"></div>

<script>
  // Detección de rutas (mantener esta lógica)
  let version = '0.4.1';

  var pathname = window.location.pathname;
  if (pathname.endsWith('/index.html')) {
    pathname = pathname.replace('/index.html', '/');
  }
  pathname = pathname.replace('/public/', '/');
  if (!pathname.endsWith('/')) {
    pathname += '/';
  }

  var isDev = /^(localhost|127\.0\.0\.1|0\.0\.0\.0|.*\.local|192\.168\.|10\.)/.test(window.location.hostname) ||
              ['3000', '5173', '8080'].includes(window.location.port);
  
  // ✅ Configuración sin variables globales intermedias
  var appConfig_factory_saas = {
    slug: 'backsystem',
    version: isDev ? `dev-${Date.now()}` : version,
    environment: isDev ? 'development' : 'production',
    isDevelopment: isDev,

    // Rutas directamente en config
    baseUrl: pathname,
    frameworkUrl: pathname + 'framework/',
    publicUrl: window.location.origin + pathname,
    frameworkPath: 'framework',

    container: '#app',
    defaultView: 'dashboard/dashboard',

    i18n: {
      enabled: true,
      defaultLang: 'es',
      availableLangs: ['es', 'en']
    },

    auth: {
      enabled: true,
      loginView: 'auth/login',
      redirectAfterLogin: 'dashboard/dashboard',
      sessionCheckInterval: 1 * 60 * 1000,
      api: {
        login: '/api/auth/login',
        logout: '/api/auth/logout',
        me: '/api/user/profile'
      }
    },

    routes: {
      coreViews: 'framework/js/views',
      extensionViews: 'extensions/{extensionName}/views'
    },

    cache: {
      views: !isDev,
      forms: !isDev
    }
  };

  (function() {
    const script = document.createElement('script');
    script.src = pathname + 'og-framework.js?v=' + appConfig_factory_saas.version;
    script.onload = function() {
      if (window.ogFramework) {
        ogFramework.register('backsystem', appConfig_factory_saas);
      }
    };
    script.onerror = function() {
      console.error('❌ Error cargando ogFramework');
      document.getElementById('app').innerHTML = `
        <div style="padding: 20px; color: #dc3545; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 5px; margin: 20px;">
          <h2>Error de Carga</h2>
          <p>No se pudo cargar el framework. Por favor, recarga la página.</p>
          <button onclick="location.reload()" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer;">
            Recargar
          </button>
        </div>
      `;
    };
    document.head.appendChild(script);
  })();
</script>
</body>
</html>